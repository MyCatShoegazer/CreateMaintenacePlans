# CreateMaintenacePlans

Данный T-SQL запрос создаёт планы регламентного обслуживания для указанной базы данных на СУБД MS SQL Server, где в задачи обслуживания входит обновление статистики по таблицам, дефрагментация индексов таблиц, а так же перестроение этих индексов. Задачи по регламентному обслуживанию создаются согласно задаваемому пользователем расписанию.

## Требования

Для корректной работы запланированных задач обслуживания на сервере должна быть запущена служба _Агент SQL Server_ для того экземпляра под управлением, которого будет выполняться запрос и задачи обслуживания. В противном случая не гарантируется исполнение запланированных событий, так как слубжа агента отслеживает их исполнение.

## Использование

Необходимо отредактировать слудующий фрагмент кода запроса в соотвествии с требованиями к имени базы данных и расписанию регламентных работ:

```SQL
INSERT INTO _variables (variable, value) VALUES
	('dbName', 'AdventureWorks2014'),	-- имя базы данных
	('statsStartTime', '180000'), 		-- время начала обновления статистики
	('statsFreqInterval', '1'),			-- частота обновления статистики в днях
	('defragStartTime', '200000'), 		-- время начала дефрагментации индексов
	('defragFreqInterval', '1'),		-- частота дефрагментации в днях
	('reindexStartTime', '220000'), 	-- время начала реиндексации таблиц
	('reindexFreqInterval', '1')		-- частота реиндексации таблиц в днях
GO
```

### Описание параметров

Все описываемые параметры принимают значения типа NCHAR / NVARCHAR / VARCHAR.

#### dbName

Данный параметр принимает имя базы данных, для которой требуется создать планы обслуживания.

> Все задачи и параметры расписания будут созданы с префиксом имени выбранной базы данных в своём названии.

#### statsStartTime

Указывает время в 24-х часовом формате, когда необходимо запускать задачу обновления статистики таблиц, где значение `210000` эквивалентно времени `21:00:00`.

#### statsFreqInterval

Указывает частоту обновления статистики в днях, где значение `1` будет означать запуск задачи каждый день в указанное время **statsStartTime**, а значение `15` означает запуск задачи каждые 15 дней в указанное время **statsStartTime**.
